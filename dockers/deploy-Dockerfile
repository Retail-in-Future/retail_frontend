FROM fedora:25

RUN dnf -y update && dnf clean all
RUN dnf -y install nginx && dnf clean all

RUN curl -o /etc/yum.repos.d/yarn.repo https://dl.yarnpkg.com/rpm/yarn.repo
RUN curl --silent --location https://rpm.nodesource.com/setup_6.x | bash -
RUN dnf install -y yarn findutils

ENV PROJECT_PATH=/root/project

WORKDIR $PROJECT_PATH
COPY ./ retail_frontend/

WORKDIR $PROJECT_PATH/retail_frontend
RUN rm -f yarn.lock
RUN npm install cross-env jest

RUN yarn install
RUN yarn build

COPY nginx.conf /etc/nginx/nginx.conf
COPY dist /usr/share/nginx/html

EXPOSE 90

CMD systemctl restart nginx.service 